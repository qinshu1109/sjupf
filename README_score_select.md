# 电商数据智能过滤评分系统

## 📋 功能概述

`score_select.py` 是一个专业的电商数据过滤评分系统，通过多维度评分算法和节日模式感知，从海量电商数据中智能筛选出TOP50高价值商品。

## 🎯 核心特性

### ✅ 多维度评分算法
- **长尾截断算法** - 99分位截断 + 对数标准化
- **Commission分段评分** - 四段式佣金激励评分
- **余弦衰减算法** - 达人影响力评分
- **指数衰减算法** - 排名位置价值评分
- **增长潜力评分** - 基于增长率的动态评估
- **渠道分布评分** - 多渠道平衡性评估
- **转化率过滤** - 质量门槛过滤机制

### ✅ 节日模式感知
- **自动检测** - 距离下一节日≤45天自动启用
- **权重调整** - sales_7d权重+2%，销量榜基础分+2%
- **内置节日** - 元旦、情人节、妇女节、儿童节、中秋、国庆、圣诞

### ✅ 技术特性
- **单文件架构** - 仅依赖pandas + numpy
- **多格式支持** - CSV/XLSX自动识别
- **智能编码** - 自动检测文件编码
- **完整输出** - 保持原17字段 + total_score

## 🚀 使用方法

### 基本命令
```bash
python score_select.py --in <输入目录> --out <输出目录>
```

### 使用示例
```bash
# 处理清洗后的数据
python score_select.py --in ./data/cleaned --out ./results

# 处理多个文件
python score_select.py --in /path/to/cleaned_data --out /path/to/output
```

## 📊 输入数据格式

### 必需字段（17个标准字段）
```
product_name        - 商品名称
product_url         - 商品链接
category_l1         - 一级类目
commission          - 佣金率
sales_7d            - 近7天销量
gmv_7d              - 近7天GMV
sales_30d           - 近30天销量
gmv_30d             - 近30天GMV
live_gmv_30d        - 近30天直播GMV
live_gmv_7d         - 近7天直播GMV
card_gmv_30d        - 近30天商品卡GMV
sales_1y            - 近1年销量
conv_30d            - 近30天转化率
rank_type           - 排名类型（潜力榜/销量榜/其他）
rank_no             - 排名位置
influencer_7d       - 近7天达人数
snapshot_tag        - 快照标签
file_date           - 文件日期（YYYY-MM-DD）
data_period         - 数据周期
```

### 数据质量要求
- **转化率门槛** - conv_30d ≥ 0.02（2%）
- **数值字段** - 销量、GMV等字段为数值型
- **日期格式** - file_date为YYYY-MM-DD格式

## 📈 评分算法详解

### 1. 长尾截断与标准化
```python
# 99分位截断 → 对数变换 → Min-Max标准化
score = (log(clip(x, 99%)) - min) / (max - min)
```

### 2. Commission分段评分
```python
if c < 0.25:     score = c/0.25
elif c < 0.3:    score = 1.0 + 0.1
elif c < 0.35:   score = 1.0 + 0.15
else:            score = 1.0 + 0.2
```

### 3. 余弦衰减算法
```python
score = n / sqrt(n² + mean_n²)
```

### 4. 排名指数衰减
```python
base = 0.4 if '潜力榜' else 0.3 if '销量榜' else 0.2
rank_part = exp(-0.015 * (rank_no - 1))
score = base * 0.4 + rank_part * 0.6
```

### 5. 增长潜力评分
```python
growth_rate = sales_30d / (sales_1y/12 + 1)
penalty = 0.2 if sales_1y > 50000 else 0
score = clip(growth_rate - penalty, 0, 1)
```

## 🎄 节日模式机制

### 节日列表
| 节日 | 日期 | 商业意义 |
|------|------|----------|
| 元旦 | 01-01 | 新年促销 |
| 情人节 | 02-14 | 礼品消费 |
| 妇女节 | 03-08 | 女性消费 |
| 儿童节 | 06-01 | 亲子消费 |
| 中秋节 | 09-15 | 传统佳节 |
| 国庆节 | 10-01 | 黄金周 |
| 圣诞节 | 12-25 | 国际节日 |

### 权重调整规则
- **触发条件** - 距离下一节日 ≤ 45天
- **sales_7d权重** - 15% → 17% (+2%)
- **销量榜基础分** - 0.3 → 0.32 (+0.02)
- **其他权重** - 按比例缩放保持总和=1

## 📤 输出结果

### 文件格式
- **文件名** - `top50_combined.csv`
- **编码** - UTF-8 with BOM
- **字段** - 原17字段 + total_score

### 处理流程
1. **质量过滤** - 转化率<2%的商品淘汰
2. **多维度评分** - 8大算法计算各维度得分
3. **权重计算** - 根据节日模式调整权重
4. **总分排序** - 按total_score降序排列
5. **去重处理** - 按product_url去重
6. **TOP50筛选** - 取前50名商品

## 🧪 测试验证

### 快速测试
```bash
# 运行测试脚本
python test_score_select.py
```

### 测试内容
- ✅ 基本功能测试
- ✅ 节日模式测试
- ✅ 权重调整验证
- ✅ 输出格式检查
- ✅ 过滤机制验证

### 测试数据
使用 `test_data_sample.csv` 包含22个测试商品：
- 正常商品（20个）
- 低转化率商品（1个，应被过滤）
- 大商家商品（1个，应受惩罚）

## 📊 性能指标

### 处理能力
- **文件格式** - CSV/XLSX自动识别
- **编码支持** - UTF-8/GBK/GB2312自动检测
- **内存优化** - 向量化计算，高效处理
- **错误处理** - 完善的异常捕获机制

### 输出统计
脚本运行时会输出：
- 处理文件数量
- 淘汰行数统计
- 节日模式状态
- 去重处理结果
- 生成文件路径

## 🔧 故障排除

### 常见问题

**1. 文件读取失败**
- 检查文件路径是否正确
- 确认文件格式为CSV或XLSX
- 验证文件编码是否支持

**2. 字段缺失错误**
- 确保包含所有17个必需字段
- 检查字段名称是否完全匹配
- 验证数据类型是否正确

**3. 转化率过滤过多**
- 检查conv_30d字段数据质量
- 确认转化率数据格式（小数形式）
- 调整转化率阈值（如需要）

**4. 节日模式未启用**
- 检查file_date字段格式
- 确认日期是否在45天范围内
- 验证节日列表配置

### 调试建议
1. 使用测试脚本验证基本功能
2. 检查输入数据的字段完整性
3. 观察控制台输出的处理统计
4. 分析输出结果的合理性

## 📝 更新日志

### v1.0.0 (2024-12-22)
- ✅ 实现8大评分算法
- ✅ 节日模式感知系统
- ✅ 多格式文件支持
- ✅ 智能去重和TOP50筛选
- ✅ 完整的命令行接口
- ✅ 中文注释和文档

## 📞 技术支持

如遇到问题或需要功能扩展，请提供：
1. 错误信息截图
2. 输入数据样例
3. 运行环境信息
4. 具体需求描述

---
**开发者**: 数据过滤专家  
**技术栈**: Python + pandas + numpy  
**许可证**: MIT License
