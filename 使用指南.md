# 🧹 抖音电商数据清洗工具使用指南

## 🚀 快速开始

### 1. 启动应用
```bash
# 激活虚拟环境并启动应用
source douyin_cleaner_env/bin/activate
streamlit run app.py
```

### 2. 访问应用
- **本地访问**: http://localhost:8502
- **网络访问**: http://198.18.0.1:8502

## 📋 功能特点

### ✨ 智能字段映射
应用会自动识别以下17个标准字段的各种别名：

| 标准字段 | 支持的别名示例 |
|---------|---------------|
| product_name | 商品、商品名称、产品名、商品标题 |
| product_url | 商品链接、抖音商品链接、链接 |
| category_l1 | 商品分类、分类、一级分类、类目 |
| commission | 佣金比例、佣金、提成比例、分成 |
| sales_7d | 周销量、近7天销量、7天销量 |
| gmv_7d | 周销售额、近7天销售额、7天GMV |
| sales_30d | 近30天销量、30天销量、月销量 |
| gmv_30d | 近30天销售额、30天销售额 |
| conv_30d | 30天转化率、转化率、转换率 |
| rank_no | 排名、排行、名次 |
| influencer_7d | 周带货达人、关联达人、带货达人 |

### 🔄 自动元数据提取
从文件名自动提取：
- **榜单类型**: 销量榜、热推榜、潜力榜、持续好货榜、同期榜
- **时间标签**: 20250427-20250526 或 30d 格式
- **数据来源**: 文件名首段作为来源表标识

### 📊 数据处理流程
1. **文件验证** → 检查格式和大小
2. **字段映射** → 自动识别和匹配标准字段
3. **数值标准化** → 调用numeric_normalizer函数
4. **元数据提取** → 从文件名提取业务信息
5. **标准化输出** → 统一17字段格式
6. **批量打包** → ZIP文件下载

## 🛠️ 使用步骤

### Step 1: 上传文件
1. 在左侧边栏点击"选择Excel文件"
2. 支持同时上传多个.xlsx或.xls文件
3. 文件大小限制：50MB（超过会警告但继续处理）

### Step 2: 查看映射预览
- 上传后自动显示字段映射关系
- 绿色✅表示成功识别的字段数量
- 可展开查看详细映射关系

### Step 3: 开始处理
1. 点击"🚀 开始清洗"按钮
2. 观察实时处理进度
3. 查看处理结果统计

### Step 4: 下载结果
1. 查看数据预览（前10行）
2. 点击"📥 下载所有结果 (ZIP)"
3. 获得包含所有清洗结果的ZIP文件

## ⚙️ 自定义配置

### 替换数值标准化函数
在`app.py`中找到以下代码段：
```python
def numeric_normalizer(df: pd.DataFrame) -> pd.DataFrame:
    """
    TODO: paste your numeric_normalizer(df) here
    """
    # 在这里粘贴您的实际函数实现
    return df
```

### 示例实现
```python
def numeric_normalizer(df: pd.DataFrame) -> pd.DataFrame:
    """数值标准化处理"""
    for col in df.columns:
        if df[col].dtype == 'object':
            # 处理百分比
            df[col] = df[col].astype(str).str.replace('%', '')
            # 处理万、亿单位
            df[col] = df[col].str.replace('w', '0000')
            df[col] = df[col].str.replace('万', '0000')
            df[col] = df[col].str.replace('亿', '00000000')
            # 转换为数值
            df[col] = pd.to_numeric(df[col], errors='ignore')
    return df
```

## 🧪 测试数据

已为您生成测试数据文件：
- `test_data/销量榜-手机数码-20250622-20250630.xlsx`
- `test_data/热推榜-美妆护肤-20250622-30d.xlsx`

这些文件包含：
- ✅ 不同的字段命名方式
- ✅ 模拟的数值格式（百分比、万、亿）
- ✅ 文件名元数据信息

## 🔧 故障排除

### 常见问题

**Q: 应用无法启动？**
A: 确保已激活虚拟环境：`source douyin_cleaner_env/bin/activate`

**Q: 字段映射不准确？**
A: 检查Excel文件的表头是否在第一行，字段名是否包含支持的别名

**Q: 处理失败？**
A: 查看错误信息，常见原因：
- 文件格式不正确
- 文件损坏或为空
- 内存不足（文件过大）

**Q: 下载的ZIP文件为空？**
A: 确保至少有一个文件处理成功，检查处理结果统计

### 性能优化建议

1. **文件大小**: 建议单个文件不超过10MB以获得最佳性能
2. **批量处理**: 一次处理的文件数量建议不超过20个
3. **内存管理**: 处理大文件时关闭其他占用内存的应用

## 📞 技术支持

如需帮助，请提供：
1. 错误信息截图
2. 示例数据文件
3. 期望的处理结果

---
**🧹 抖音电商数据清洗工具 | 专业数据处理解决方案**
